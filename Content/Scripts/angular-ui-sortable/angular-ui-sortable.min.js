angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(n,t,i){return{require:"?ngModel",scope:{ngModel:"=ngModel",uiSortable:"=uiSortable"},link:function(r,u,f,e){function c(n,t){return t&&typeof t=="function"?function(i,r){n(i,r);t(i,r)}:n}function a(n,t){var i=n.sortable("option","helper");return i==="clone"||typeof i=="function"&&t.item.sortable.isCustomHelperUsed()}function p(n){return/left|right/.test(n.css("float"))||/inline|table-cell/.test(n.css("display"))}function v(n,t){t.item.sortable._destroy()}var o,s={},y={"ui-floating":undefined},h={receive:null,remove:null,start:null,stop:null,update:null},l={helper:null};if(angular.extend(s,y,n,r.uiSortable),!angular.element.fn||!angular.element.fn.jquery){i.error("ui.sortable: jQuery should be included before AngularJS!");return}e?(r.$watch("ngModel.length",function(){t(function(){!u.sortable("instance")||u.sortable("refresh")},0,!1)}),h.start=function(n,t){if(s["ui-floating"]==="auto"){var i=t.item.siblings();angular.element(n.target).sortable("instance").floating=p(i)}t.item.sortable={model:e.$modelValue[t.item.index()],index:t.item.index(),source:t.item.parent(),sourceModel:e.$modelValue,cancel:function(){t.item.sortable._isCanceled=!0},isCanceled:function(){return t.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!t.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:t.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(t.item.sortable,function(n,i){t.item.sortable[i]=undefined})}}},h.activate=function(){var n,t,i;o=u.contents();n=u.sortable("option","placeholder");n&&n.element&&typeof n.element=="function"&&(t=n.element(),t=angular.element(t),i=u.find('[class="'+t.attr("class")+'"]'),o=o.not(i))},h.update=function(n,t){var i,f;t.item.sortable.received||(t.item.sortable.dropindex=t.item.index(),i=t.item.parent(),t.item.sortable.droptarget=i,f=i.attr("ng-model")||i.attr("data-ng-model"),t.item.sortable.droptargetModel=i.scope().$eval(f),u.sortable("cancel"));a(u,t)&&!t.item.sortable.received&&u.sortable("option","appendTo")==="parent"&&(o=o.not(o.last()));o.appendTo(u);t.item.sortable.received&&(o=null);t.item.sortable.received&&!t.item.sortable.isCanceled()&&r.$apply(function(){e.$modelValue.splice(t.item.sortable.dropindex,0,t.item.sortable.moved)})},h.stop=function(n,t){!t.item.sortable.received&&"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()?r.$apply(function(){e.$modelValue.splice(t.item.sortable.dropindex,0,e.$modelValue.splice(t.item.sortable.index,1)[0])}):"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()||a(u,t)||o.appendTo(u);o=null},h.receive=function(n,t){t.item.sortable.received=!0},h.remove=function(n,t){"dropindex"in t.item.sortable||(u.sortable("cancel"),t.item.sortable.cancel());t.item.sortable.isCanceled()||r.$apply(function(){t.item.sortable.moved=e.$modelValue.splice(t.item.sortable.index,1)[0]})},l.helper=function(n){return n&&typeof n=="function"?function(t,i){var r=n(t,i);return i.sortable._isCustomHelperUsed=i!==r,r}:n},r.$watch("uiSortable",function(n){!u.sortable("instance")||angular.forEach(n,function(n,t){if(t in y){t==="ui-floating"&&(n===!1||n===!0)&&(u.sortable("instance").floating=n);s[t]=n;return}h[t]?(t==="stop"&&(n=c(n,function(){r.$apply()}),n=c(n,v)),n=c(h[t],n)):l[t]&&(n=l[t](n));s[t]=n;u.sortable("option",t,n)})},!0),angular.forEach(h,function(n,t){s[t]=c(n,s[t]);t==="stop"&&(s[t]=c(s[t],v))})):i.info("ui.sortable: ngModel not provided!",u);u.sortable(s)}}}]);